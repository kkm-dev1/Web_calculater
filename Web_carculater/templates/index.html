<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ ê³„ì‚°ê¸° - Python Flask</title>
    <!-- CSS íŒŒì¼ ì—°ê²° -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ ìš”ì†Œ -->
    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <div class="calculator-wrapper">
            <!-- í—¤ë” -->
            <div class="header">
                <h1>ğŸ§® ì›¹ ê³„ì‚°ê¸°</h1>
                <p>Python Flaskë¡œ êµ¬í˜„í•œ í˜„ëŒ€ì ì¸ ê³„ì‚°ê¸°</p>
            </div>

            <!-- ê³„ì‚°ê¸° ë³¸ì²´ -->
            <div class="calculator">
                <!-- ë””ìŠ¤í”Œë ˆì´ ì˜ì—­ -->
                <div class="display-container">
                    <!-- ìˆ˜ì‹ í‘œì‹œ ì˜ì—­ -->
                    <div class="expression" id="expression">0</div>
                    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                    <div class="result" id="result">0</div>
                </div>

                <!-- ë²„íŠ¼ ê·¸ë¦¬ë“œ -->
                <div class="buttons">
                    <!-- ì²« ë²ˆì§¸ í–‰: ê¸°ëŠ¥ ë²„íŠ¼ -->
                    <button class="btn btn-function" onclick="clearAll()">AC</button>
                    <button class="btn btn-function" onclick="deleteLast()">âŒ«</button>
                    <button class="btn btn-function" onclick="appendToExpression('(')">(</button>
                    <button class="btn btn-function" onclick="appendToExpression(')')">)</button>

                    <!-- ë‘ ë²ˆì§¸ í–‰: 7, 8, 9, ë‚˜ëˆ„ê¸° -->
                    <button class="btn btn-number" onclick="appendToExpression('7')">7</button>
                    <button class="btn btn-number" onclick="appendToExpression('8')">8</button>
                    <button class="btn btn-number" onclick="appendToExpression('9')">9</button>
                    <button class="btn btn-operator" onclick="appendToExpression('/')">Ã·</button>

                    <!-- ì„¸ ë²ˆì§¸ í–‰: 4, 5, 6, ê³±í•˜ê¸° -->
                    <button class="btn btn-number" onclick="appendToExpression('4')">4</button>
                    <button class="btn btn-number" onclick="appendToExpression('5')">5</button>
                    <button class="btn btn-number" onclick="appendToExpression('6')">6</button>
                    <button class="btn btn-operator" onclick="appendToExpression('*')">Ã—</button>

                    <!-- ë„¤ ë²ˆì§¸ í–‰: 1, 2, 3, ë¹¼ê¸° -->
                    <button class="btn btn-number" onclick="appendToExpression('1')">1</button>
                    <button class="btn btn-number" onclick="appendToExpression('2')">2</button>
                    <button class="btn btn-number" onclick="appendToExpression('3')">3</button>
                    <button class="btn btn-operator" onclick="appendToExpression('-')">âˆ’</button>

                    <!-- ë‹¤ì„¯ ë²ˆì§¸ í–‰: 0, ì†Œìˆ˜ì , =, ë”í•˜ê¸° -->
                    <button class="btn btn-number" onclick="appendToExpression('0')">0</button>
                    <button class="btn btn-number" onclick="appendToExpression('.')">.</button>
                    <button class="btn btn-equals" onclick="calculate()">=</button>
                    <button class="btn btn-operator" onclick="appendToExpression('+')">+</button>
                </div>
            </div>

            <!-- í‘¸í„° ì •ë³´ -->
            <div class="footer">
                <p>ğŸ’¡ íŒ: í‚¤ë³´ë“œë¡œë„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ìˆ«ì, ì—°ì‚°ì, Enter)</p>
            </div>
        </div>
    </div>

    <!-- JavaScript ì½”ë“œ -->
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentExpression = '';  // í˜„ì¬ ì…ë ¥ëœ ìˆ˜ì‹
        let displayExpression = '';  // í™”ë©´ì— í‘œì‹œë˜ëŠ” ìˆ˜ì‹ (ì—°ì‚°ì ë³€í™˜)

        /**
         * ìˆ˜ì‹ì— ë¬¸ì ì¶”ê°€
         * @param {string} value - ì¶”ê°€í•  ë¬¸ì (ìˆ«ì ë˜ëŠ” ì—°ì‚°ì)
         */
        function appendToExpression(value) {
            // ì²« ì…ë ¥ì´ê³  0ì´ í‘œì‹œë˜ì–´ ìˆìœ¼ë©´ ì´ˆê¸°í™”
            if (currentExpression === '' && document.getElementById('expression').textContent === '0') {
                currentExpression = '';
                displayExpression = '';
            }

            // ì‹¤ì œ ê³„ì‚°ì— ì‚¬ìš©ë  ìˆ˜ì‹ì— ì¶”ê°€ (/, * ì‚¬ìš©)
            currentExpression += value;
            
            // í™”ë©´ í‘œì‹œìš© ìˆ˜ì‹ (Ã·, Ã— ì‚¬ìš©)
            let displayValue = value;
            if (value === '/') displayValue = 'Ã·';
            if (value === '*') displayValue = 'Ã—';
            if (value === '-') displayValue = 'âˆ’';
            
            displayExpression += displayValue;

            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateDisplay();
        }

        /**
         * ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
         * ìˆ˜ì‹ê³¼ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œ
         */
        function updateDisplay() {
            const expressionElement = document.getElementById('expression');
            const resultElement = document.getElementById('result');

            // ìˆ˜ì‹ì´ ë¹„ì–´ìˆìœ¼ë©´ 0 í‘œì‹œ
            if (currentExpression === '') {
                expressionElement.textContent = '0';
                resultElement.textContent = '0';
            } else {
                // ìˆ˜ì‹ì„ í™”ë©´ì— í‘œì‹œ (ì‚¬ìš©ì ì¹œí™”ì  ì—°ì‚°ì)
                expressionElement.textContent = displayExpression;
                
                // ì‹¤ì‹œê°„ìœ¼ë¡œ ì¤‘ê°„ ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (ì—ëŸ¬ëŠ” ë¬´ì‹œ)
                try {
                    const previewResult = eval(currentExpression);
                    if (!isNaN(previewResult) && isFinite(previewResult)) {
                        resultElement.textContent = formatNumber(previewResult);
                    }
                } catch (e) {
                    // ì¤‘ê°„ ìˆ˜ì‹ì´ ë¶ˆì™„ì „í•˜ë©´ ë¬´ì‹œ
                    resultElement.textContent = '';
                }
            }
        }

        /**
         * ìˆ«ì í¬ë§·íŒ…
         * @param {number} num - í¬ë§·íŒ…í•  ìˆ«ì
         * @returns {string} í¬ë§·ëœ ìˆ«ì ë¬¸ìì—´
         */
        function formatNumber(num) {
            // ì •ìˆ˜ì¸ ê²½ìš° ì†Œìˆ˜ì  ì œê±°
            if (Number.isInteger(num)) {
                return num.toString();
            }
            // ì†Œìˆ˜ì¸ ê²½ìš° ë¶ˆí•„ìš”í•œ 0 ì œê±°
            return parseFloat(num.toFixed(10)).toString();
        }

        /**
         * ê³„ì‚° ì‹¤í–‰
         * ì„œë²„ì— ê³„ì‚° ìš”ì²­ì„ ë³´ë‚´ê³  ê²°ê³¼ë¥¼ ë°›ì•„ì˜´
         */
        async function calculate() {
            if (currentExpression === '') return;

            try {
                // Flask ì„œë²„ì— POST ìš”ì²­
                const response = await fetch('/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        expression: currentExpression
                    })
                });

                // ì‘ë‹µ ë°ì´í„° íŒŒì‹±
                const data = await response.json();
                const result = data.result;

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('result').textContent = result;

                // ì—ëŸ¬ê°€ ì•„ë‹Œ ê²½ìš° ê²°ê³¼ë¥¼ ìƒˆë¡œìš´ ìˆ˜ì‹ìœ¼ë¡œ ì„¤ì •
                if (!result.toString().startsWith('ì˜¤ë¥˜')) {
                    currentExpression = result.toString();
                    displayExpression = result.toString();
                    document.getElementById('expression').textContent = result;
                } else {
                    // ì—ëŸ¬ì¸ ê²½ìš° ìˆ˜ì‹ ì´ˆê¸°í™”
                    currentExpression = '';
                    displayExpression = '';
                }

            } catch (error) {
                // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë“± ì²˜ë¦¬
                document.getElementById('result').textContent = 'ì˜¤ë¥˜: ì„œë²„ ì—°ê²° ì‹¤íŒ¨';
                console.error('Error:', error);
            }
        }

        /**
         * ì „ì²´ ì§€ìš°ê¸° (All Clear)
         */
        function clearAll() {
            currentExpression = '';
            displayExpression = '';
            document.getElementById('expression').textContent = '0';
            document.getElementById('result').textContent = '0';
        }

        /**
         * ë§ˆì§€ë§‰ ë¬¸ì ì‚­ì œ (Backspace)
         */
        function deleteLast() {
            if (currentExpression.length > 0) {
                currentExpression = currentExpression.slice(0, -1);
                displayExpression = displayExpression.slice(0, -1);
                updateDisplay();
            }
        }

        /**
         * í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬
         */
        document.addEventListener('keydown', function(event) {
            const key = event.key;

            // ìˆ«ì ì…ë ¥
            if (/^[0-9]$/.test(key)) {
                appendToExpression(key);
            }
            // ì—°ì‚°ì ì…ë ¥
            else if (['+', '-', '*', '/'].includes(key)) {
                appendToExpression(key);
            }
            // ì†Œìˆ˜ì 
            else if (key === '.') {
                appendToExpression('.');
            }
            // ê´„í˜¸
            else if (key === '(' || key === ')') {
                appendToExpression(key);
            }
            // Enter í‚¤ë¡œ ê³„ì‚°
            else if (key === 'Enter') {
                event.preventDefault();
                calculate();
            }
            // Backspaceë¡œ ì‚­ì œ
            else if (key === 'Backspace') {
                event.preventDefault();
                deleteLast();
            }
            // Escapeë¡œ ì „ì²´ ì§€ìš°ê¸°
            else if (key === 'Escape') {
                clearAll();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            clearAll();
        };
    </script>
</body>
</html>

